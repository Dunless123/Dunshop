{"version":3,"file":"search.js","sources":["pages/search/search.vue","../../HbuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VhcmNoL3NlYXJjaC52dWU"],"sourcesContent":["<template>\n\t<view class=\"searchLayout\">\n\t\t<uni-search-bar class=\"search\" :focus=\"true\" v-model=\"searchValue\" @blur=\"blur\" @focus=\"focus\" @input=\"input\"\n\t\t\tcancelButton=\"none\">\n\t\t</uni-search-bar>\n\t\t<view v-if=\"!classList.length || noSearch\">\n\t\t\t<view class=\"history\" v-if=\"historySearch.length\">\n\t\t\t\t<view class=\"topTitle\">\n\t\t\t\t\t<view class=\"text\">最近搜索</view>\n\t\t\t\t\t<view class=\"icon\" @click=\"removeHistory\">\n\t\t\t\t\t\t<uni-icons type=\"trash\" size=\"25\"></uni-icons>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"tabs\">\n\t\t\t\t\t<view class=\"tab\" v-for=\"tab in historySearch\" :key=\"tab\" @click=\"clickTab(tab)\">{{tab}}</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<view class=\"recommend\">\n\t\t\t\t<view class=\"topTitle\">\n\t\t\t\t\t<view class=\"text\">热门搜索</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"tabs\">\n\t\t\t\t\t<view class=\"tab\" v-for=\"tab in recommendList\" :key=\"tab\" @click=\"clickTab(tab)\">{{tab}}</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\n\n\t\t<view class=\"noSearch\" v-if=\"noSearch\">\n\t\t\t<uv-empty mode=\"search\" icon=\"http://cdn.uviewui.com/uview/empty/search.png\"></uv-empty>\n\t\t</view>\n\n\n\t\t<view v-else>\n\t\t\t<view class=\"list\">\n\t\t\t\t<navigator :url=\"`/pages/preview/preview?id=${item._id}`\" class=\"item\" v-for=\"item in classList\"\n\t\t\t\t\t:key=\"item._id\">\n\t\t\t\t\t<image :src=\"item.smallPicurl\" mode=\"aspectFill\"></image>\n\t\t\t\t</navigator>\n\t\t\t</view>\n\t\t\t<view class=\"loadingLayout\" v-if=\"noData || classList.length\">\n\t\t\t\t<uni-load-more :status=\"noData?'noMore':'loading'\" />\n\t\t\t</view>\n\t\t</view>\n\n\t</view>\n</template>\n\n<script setup>\n\timport {\n\t\tref\n\t} from 'vue';\n\timport {\n\t\tonLoad,\n\t\tonUnload,\n\t\tonReachBottom\n\t} from \"@dcloudio/uni-app\";\n\t// import {\n\t// \tapiSearchData\n\t// } from \"../../aip/aip\";\n\t//查询参数\n\tconst queryParams = ref({\n\t\tpageNum: 1,\n\t\tpageSize: 12,\n\t\tkeyword: \"\"\n\t})\n\tconst searchValue = ref('0')\n\tconst search = (res) => {\n\t\tuni.showToast({\n\t\t\ttitle: '搜索：' + res.value,\n\t\t\ticon: 'none'\n\t\t})\n\t}\n\tconst input = (res) => {\n\t\t// console.log('----input:', res)\n\t}\n\tconst blur = (res) => {\n\t\tuni.showToast({\n\t\t\ttitle: 'blur事件，输入值为：' + res.value,\n\t\t\ticon: 'none'\n\t\t})\n\t}\n\tconst focus = (e) => {\n\t\tuni.showToast({\n\t\t\ttitle: 'focus事件，输出值为：' + e.value,\n\t\t\ticon: 'none'\n\t\t})\n\t}\n\t//搜索历史词\n\tconst historySearch = ref(uni.getStorageSync(\"historySearch\") || []);\n\n\t//热门搜索词\n\tconst recommendList = ref([\"美女\", \"帅哥\", \"宠物\", \"卡通\"]);\n\n\t//没有更多\n\tconst noData = ref(false);\n\t//没有搜索结果\n\tconst noSearch = ref(false);\n\n\t//搜索结果列表\n\tconst classList = ref([]);\n\n\n\t//点击搜索\n\tconst onSearch = () => {\n\t\tuni.showLoading()\n\t\thistorySearch.value = [...new Set([queryParams.value.keyword, ...historySearch.value])].slice(0, 10);\n\n\t\tuni.setStorageSync(\"historySearch\", historySearch.value);\n\t\tinitParams(queryParams.value.keyword);\n\t\tsearchData();\n\t\tconsole.log(queryParams.value.keyword);\n\t}\n\n\t//点击清除按钮\n\tconst onClear = () => {\n\t\tinitParams();\n\t}\n\n\n\n\t//点击标签进行搜索\n\tconst clickTab = (value) => {\n\t\tinitParams(value);\n\n\t\tonSearch();\n\t}\n\n\n\t//点击清空搜索记录\n\tconst removeHistory = () => {\n\t\tuni.showModal({\n\t\t\ttitle: \"是否清空历史搜索？\",\n\t\t\tsuccess: res => {\n\t\t\t\tif (res.confirm) {\n\t\t\t\t\tuni.removeStorageSync(\"historySearch\");\n\t\t\t\t\thistorySearch.value = []\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\tconst searchData = async () => {\n\t\ttry {\n\t\t\t// let res = await apiSearchData(queryParams.value);\n\t\t\tclassList.value = [...classList.value, ...res.data];\n\t\t\tuni.setStorageSync(\"storgClassList\", classList.value);\n\t\t\tif (queryParams.value.pageSize > res.data.length) noData.value = true;\n\t\t\tif (res.data.length == 0 && classList.value.length == 0) noSearch.value = true;\n\t\t\tconsole.log(res);\n\t\t} finally {\n\t\t\tuni.hideLoading()\n\t\t}\n\n\t}\n\n\tconst initParams = (value = '') => {\n\t\tclassList.value = [];\n\t\tnoData.value = false;\n\t\tnoSearch.value = false;\n\t\tqueryParams.value = {\n\t\t\tpageNum: 1,\n\t\t\tpageSize: 12,\n\t\t\tkeyword: value || \"\"\n\t\t}\n\t}\n\n\n\t//触底加载更多\n\tonReachBottom(() => {\n\t\tif (noData.value) return;\n\t\tqueryParams.value.pageNum++\n\t\tsearchData();\n\t})\n\n\t//关闭有页面\n\tonUnload(() => {\n\t\tuni.removeStorageSync(\"storgClassList\", classList.value);\n\t})\n</script>\n\n<style scoped lang=\"scss\">\n\t.searchLayout {\n\t\t.search {\n\t\t\t// padding: 5rpx;\n\n\t\t}\n\n\t\t.topTitle {\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: space-between;\n\t\t\talign-items: center;\n\t\t\tfont-size: 32rpx;\n\t\t\tcolor: #999;\n\t\t}\n\n\t\t.history {\n\t\t\tpadding: 10rpx;\n\t\t}\n\n\t\t.recommend {\n\t\t\tpadding: 10rpx;\n\t\t}\n\n\t\t.tabs {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tflex-wrap: wrap;\n\t\t\tpadding-top: 10rpx;\n\n\t\t\t.tab {\n\t\t\t\tbackground: #F4F4F4;\n\t\t\t\tfont-size: 28rpx;\n\t\t\t\tcolor: #333;\n\t\t\t\tpadding: 10rpx 28rpx;\n\t\t\t\tborder-radius: 50rpx;\n\t\t\t\tmargin-right: 20rpx;\n\t\t\t\tmargin-top: 20rpx;\n\t\t\t}\n\t\t}\n\n\t\t.list {\n\t\t\tdisplay: grid;\n\t\t\tgrid-template-columns: repeat(3, 1fr);\n\t\t\tgap: 5rpx;\n\t\t\tpadding: 20rpx 5rpx;\n\n\t\t\t.item {\n\t\t\t\theight: 440rpx;\n\n\t\t\t\timage {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tdisplay: block;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n</style>","import MiniProgramPage from 'E:/桌面/dun-shop-master/pages/search/search.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","res","uni","onReachBottom","onUnload"],"mappings":";;;;;;;;;;;;;;;;;;;AA8DC,UAAM,cAAcA,cAAAA,IAAI;AAAA,MACvB,SAAS;AAAA,MACT,UAAU;AAAA,MACV,SAAS;AAAA,IACX,CAAE;AACD,UAAM,cAAcA,cAAG,IAAC,GAAG;AAO3B,UAAM,QAAQ,CAACC,SAAQ;AAAA,IAEtB;AACD,UAAM,OAAO,CAACA,SAAQ;AACrBC,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAO,iBAAiBD,KAAI;AAAA,QAC5B,MAAM;AAAA,MACT,CAAG;AAAA,IACD;AACD,UAAM,QAAQ,CAAC,MAAM;AACpBC,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAO,kBAAkB,EAAE;AAAA,QAC3B,MAAM;AAAA,MACT,CAAG;AAAA,IACD;AAED,UAAM,gBAAgBF,cAAAA,IAAIE,cAAG,MAAC,eAAe,eAAe,KAAK,CAAA,CAAE;AAGnE,UAAM,gBAAgBF,cAAAA,IAAI,CAAC,MAAM,MAAM,MAAM,IAAI,CAAC;AAGlD,UAAM,SAASA,kBAAI,KAAK;AAExB,UAAM,WAAWA,kBAAI,KAAK;AAG1B,UAAM,YAAYA,kBAAI,CAAA,CAAE;AAIxB,UAAM,WAAW,MAAM;AACtBE,oBAAAA,MAAI,YAAa;AACjB,oBAAc,QAAQ,CAAC,GAAG,oBAAI,IAAI,CAAC,YAAY,MAAM,SAAS,GAAG,cAAc,KAAK,CAAC,CAAC,EAAE,MAAM,GAAG,EAAE;AAEnGA,oBAAAA,MAAI,eAAe,iBAAiB,cAAc,KAAK;AACvD,iBAAW,YAAY,MAAM,OAAO;AACpC;AACAA,oBAAA,MAAA,MAAA,OAAA,kCAAY,YAAY,MAAM,OAAO;AAAA,IACrC;AAUD,UAAM,WAAW,CAAC,UAAU;AAC3B,iBAAW,KAAK;AAEhB;IACA;AAID,UAAM,gBAAgB,MAAM;AAC3BA,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAO;AAAA,QACP,SAAS,CAAAD,SAAO;AACf,cAAIA,KAAI,SAAS;AAChBC,gCAAI,kBAAkB,eAAe;AACrC,0BAAc,QAAQ,CAAE;AAAA,UACxB;AAAA,QACD;AAAA,MACJ,CAAG;AAAA,IACD;AAED,UAAM,aAAa,YAAY;AAC9B,UAAI;AAEH,kBAAU,QAAQ,CAAC,GAAG,UAAU,OAAO,GAAG,IAAI,IAAI;AAClDA,sBAAAA,MAAI,eAAe,kBAAkB,UAAU,KAAK;AACpD,YAAI,YAAY,MAAM,WAAW,IAAI,KAAK;AAAQ,iBAAO,QAAQ;AACjE,YAAI,IAAI,KAAK,UAAU,KAAK,UAAU,MAAM,UAAU;AAAG,mBAAS,QAAQ;AAC1EA,sBAAAA,MAAA,MAAA,OAAA,kCAAY,GAAG;AAAA,MAClB,UAAY;AACTA,sBAAAA,MAAI,YAAa;AAAA,MACjB;AAAA,IAED;AAED,UAAM,aAAa,CAAC,QAAQ,OAAO;AAClC,gBAAU,QAAQ;AAClB,aAAO,QAAQ;AACf,eAAS,QAAQ;AACjB,kBAAY,QAAQ;AAAA,QACnB,SAAS;AAAA,QACT,UAAU;AAAA,QACV,SAAS,SAAS;AAAA,MAClB;AAAA,IACD;AAIDC,kBAAAA,cAAc,MAAM;AACnB,UAAI,OAAO;AAAO;AAClB,kBAAY,MAAM;AAClB;IACF,CAAE;AAGDC,kBAAAA,SAAS,MAAM;AACdF,oBAAAA,MAAI,kBAAkB,kBAAkB,UAAU,KAAK;AAAA,IACzD,CAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClLF,GAAG,WAAW,eAAe;"}